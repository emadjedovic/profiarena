<div id="calendar"></div>

<%- include('../partials/addInterviewModal') %>
<%- include('../partials/editInterviewModal') %>

<script>

  let calendar;

  document.addEventListener('DOMContentLoaded', function() {

    const calendarEl = document.getElementById('calendar');
    const events = JSON.parse('<%- events %>');

    calendar = new FullCalendar.Calendar(calendarEl, {

      initialView: 'dayGridMonth',

      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay',
      },

      events: events,

      // Day click handler
      dateClick: function(info) {
        const clickedDate = info.dateStr; // date in YYYY-MM-DD format
        openAddInterviewModal(clickedDate);
      },

      // Event click handler for editing
      eventClick: function(info) {
        const interview = info.event;
        if (!interview.id) {
          console.error('Event ID is missing!');
          return;
        }
        openEditInterviewModal(interview);
      },
    });

    function openAddInterviewModal(clickedDate) {
      const modal = document.getElementById("addInterviewModal");
      const proposedTimeInput = document.getElementById("proposed_time");
      proposedTimeInput.value = clickedDate + "T09:00"; // Set a default time (e.g., 9:00 AM)
      $(modal).modal('show');
    }

    function openEditInterviewModal(event) {
      const modal = document.getElementById("editInterviewModal");
      document.getElementById("interview_id").value = event.id;
      document.getElementById("interview_status_id").value = event.extendedProps.status_id || '';
      document.getElementById("review").value = event.extendedProps.review || '';
      document.getElementById("proposed_time").value = event.start.toISOString().slice(0, 16);
      $(modal).modal('show');
    }

    calendar.render();
  });
</script>
